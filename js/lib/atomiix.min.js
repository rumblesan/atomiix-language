!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.atomiix=t():e.atomiix=t()}(global,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){var r,o,a;o=[t],void 0===(a="function"==typeof(r=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a={lang:{isNullOrUndefined:function(e){return null==e}},extend:function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}},i=function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return o(t,e),t}(Error),s=function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return o(t,e),t}(Error),c=function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return o(t,e),t}(Error),u=function(){function e(t){n(this,e),this.options=a.extend({},{languageName:"unnamedlanguage"},t),this.tokenTypes=[]}return t(e,[{key:"addTokenType",value:function(e){if(!e.name)throw new i("Token types must have a 'name' property");if(!e.regexp&&!e.consume)throw new i("Token types must have a 'regexp' property or a 'consume' function");if(e.regexp&&!(e.regexp instanceof RegExp))throw new i("Token types 'regexp' property must be an instance of RegExp");if(e.consume&&"function"!=typeof e.consume)throw new i("Token types 'consume' property must be a function");if(e.interpret&&"function"!=typeof e.interpret)throw new i("Token types 'interpret' property must be a function");this.tokenTypes.push(e)}},{key:"tokenize",value:function(e){if(void 0===e)throw new s("No content provided");if(0===this.tokenTypes.length)throw new s("No token types defined");for(var t,n,r=[],o=e,i=new l,c=this.tokenTypes.length;o.length>0;){for(var u=!1,p=0;p<c;p++){var f=this.tokenTypes[p];if(n=void 0,f.consume){if(!(n=f.consume(o)).success)continue;if(0!==o.indexOf(n.consumed))throw new s("The consume function for "+f.name+" failed to return the start of the remaining content at "+i.line+"."+i.character+" and instead returned "+n.consumed);u=!0,t=n.consumed}else{var h=f.regexp.exec(o);if(!h)continue;if(0!==h.index)continue;u=!0,t=h[0]}var d={content:e=f.interpret?f.interpret(t):n&&!a.lang.isNullOrUndefined(n.content)?n.content:t,type:f.name,line:i.line,character:i.character};f.ignore||r.push(d),o=o.substring(t.length),i.consume(t)}if(!u){var y=o.substring(0,15),m=y.replace("\r","\\r").replace("\t","\\t").replace("\n","\\n");throw new s("No viable alternative at "+i.line+"."+i.character+": '"+m+"...'")}}return r}}]),e}(),p=function(){function e(){n(this,e)}return t(e,null,[{key:"constant",value:function(e,t,n){return n=n||["keyword"],{name:t,regexp:new RegExp("^"+(r=e,r.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1"))),role:n};var r}},{key:"floatingPoint",value:function(){return{name:"floating point",regexp:/(^-?\d*\.\d+)/,role:["constant","numeric"],interpret:function(e){return parseFloat(e)}}}},{key:"integer",value:function(){return{name:"integer",regexp:/^-?\d+/,role:["constant","numeric"],interpret:function(e){return parseInt(e)}}}},{key:"whitespace",value:function(){return{name:"whitespace",ignore:!0,regexp:/^[ \t]+/}}},{key:"whitespaceWithNewlines",value:function(){return{name:"whitespace",ignore:!0,regexp:/^[ \t\r\n]+/}}},{key:"real",value:function(){return{name:"real number",regexp:/^X/,role:["constant","numeric"]}}},{key:"comma",value:function(){return this.constant(",","comma",["punctuation"])}},{key:"period",value:function(){return this.constant(".","period",["punctuation"])}},{key:"star",value:function(){return this.constant("*","star",["punctuation"])}},{key:"colon",value:function(){return this.constant(":","colon",["punctuation"])}},{key:"openParen",value:function(){return this.constant("(","open paren",["punctuation"])}},{key:"closeParen",value:function(){return this.constant(")","close paren",["punctuation"])}},{key:"openBracket",value:function(){return this.constant("{","open bracket",["punctuation"])}},{key:"closeBracket",value:function(){return this.constant("}","close bracket",["punctuation"])}},{key:"openSquareBracket",value:function(){return this.constant("[","open square bracket",["punctuation"])}},{key:"closeSquareBracket",value:function(){return this.constant("]","close square bracket",["punctuation"])}},{key:"JsonString",value:function(){return{name:"string",regexp:/"(?:[^"\\]|\\.)*"/,consume:function(e){var t={success:!1};if(0!==e.indexOf('"'))return t;var n,r="",o=1,a=!1;do{switch(n=e[o],o+=1,n){case'"':a=!0;break;case"\\":var i=e[o];switch(o+=1,i){case'"':return t;case"t":r+="\t";break;case"r":r+="\r";break;case"n":r+="\n";break;case"u":var s=e.substr(o,4);if(4==s.length&&/\d{4}/.test(s)){o+=4;var c=parseInt(s,10),u=String.fromCharCode(c);r+=u}else r+="\\u";break;default:return t}break;default:r+=n}}while(!a);var p=e.substring(0,o),f={success:!0,consumed:p,content:r};return f}}}}]),e}(),f=function(){function e(){n(this,e)}return t(e,[{key:"initialize",value:function(e){if(!e)throw new c("No tokens provided to the parser");if(!(e instanceof Array))throw new c("A non-array was provided to the parser instead of a token array");this.tokens=e}},{key:"la1",value:function(e){if(this.eof())throw new c("No tokens available");return this.tokens[0].type==e}},{key:"match",value:function(e){if(this.eof())throw new c("Expected "+e+" but found EOF");if(!this.la1(e))throw new c("Expected "+e+" but found "+this.tokens[0].type+" at l"+this.tokens[0].line+"."+this.tokens[0].character);return this.tokens.shift()}},{key:"eof",value:function(){return 0===this.tokens.length}},{key:"expectEof",value:function(){if(!this.eof())throw new c("Expected EOF but found "+this.tokens[0].type+" at l"+this.tokens[0].line+"."+this.tokens[0].character)}}]),e}(),l=function(){function e(){n(this,e),this.line=1,this.character=1,this.justSeenSlashR=!1}return t(e,[{key:"consume",value:function(e){for(var t=0,n=e.length;t<n;t++)"\r"==e[t]?(this.line+=1,this.character=1,this.justSeenSlashR=!0):"\n"==e[t]?(this.justSeenSlashR||(this.line+=1),this.character=1,this.justSeenSlashR=!1):(this.character+=1,this.justSeenSlashR=!1)}}]),e}();e.PatternDefinitionException=i,e.LexerException=s,e.ParserException=c,e.Lexer=u,e.StandardTokenTypes=p,e.Parser=f,e.LineTracker=l})?r.apply(t,o):r)||(e.exports=a)},function(e,t,n){"use strict";n.r(t);var r=n(0),o=r.StandardTokenTypes,a=new r.Lexer({languageName:"atomiix"});a.addTokenType(o.whitespace()),a.addTokenType({name:"newline",regexp:/^\n[ \n]*/}),a.addTokenType({name:"comment",ignore:!0,regexp:/^\/\/[^\n]*/}),a.addTokenType(o.constant("->","play arrow")),a.addTokenType(o.constant(">>","add effect arrow")),a.addTokenType(o.constant("<<","remove effect arrow")),a.addTokenType(o.openParen()),a.addTokenType(o.closeParen()),a.addTokenType({name:"operator",regexp:/^[*\/+-]+/}),a.addTokenType({name:"number",regexp:/^\d+(\.\d+)?/,role:["constant","numeric"],interpret:function(e){return parseFloat(e)}}),a.addTokenType({name:"identifier",regexp:/^[a-zA-Z][a-zA-Z0-9]*/}),a.addTokenType({name:"score",regexp:/^[{[\\|][a-zA-Z0-9 ]*[}\]\\|]/}),a.addTokenType({name:"score modifier",regexp:/^[<\\^][Z0-9 ]*[>\\^]/});var i=a,s="PROGRAM",c="PLAY",u="AGENT",p="SCORE",f="PERCUSSIVE",l="MELODIC",h="CONCRETE",d="SCOREOPERATOR",y="SCOREMODIFIER",m="PANNING",v="SUSTAIN",w="ATTACK";function g(e,t){return{type:d,operator:e,value:t}}function k(e,t,n){var o=t.charAt(0),a=t.slice(-1),i=!1;switch(o){case"|":i="|"===a;break;case"[":i="]"===a;break;case"{":i="}"===a}if(!i)throw new r.ParserException("Score delimiters don't match. Starts with ".concat(o," but ends with ").concat(a));var s=t.slice(1,-1);switch(o){case"|":if(e)throw new r.ParserException("Percussive score shouldn't have instrument: ".concat(e));return function(e,t){var n=f,r=x(e),o=r.chars,a=r.durations,i=r.offset,s=o,c=Array(o.length).fill(60);return b(n,c,a,s,i,t)}(s,n);case"[":return function(e,t,n){var r=l,o=x(t),a=o.chars,i=o.durations,s=o.offset,c=a.map(function(e){return parseInt(e,10)});return b(r,c,i,[e],s,n)}(e,s,n);case"{":return function(e,t,n){var r=h,o=x(t),a=o.chars,i=o.durations,s=o.offset,c=a.map(function(e){return parseInt(e,10)});return b(r,c,i,[e],s,n)}(e,s,n);default:throw new r.ParserException("".concat(o," is not a supported score delimiters"))}}function b(e,t,n,r,o,a){for(var i=[],s=[],c=[],u=function(e){var n=a[e];if(n.type===y)switch(n.modifierType){case m:c=n.values;break;case v:i=n.values;break;case w:s=n.values}else if(n.type===d)switch(n.operator){case"+":t=t.map(function(e){return e+n.value});break;case"-":t=t.map(function(e){return e-n.value})}},f=0;f<a.length;f+=1)u(f);return function(e,t,n,r,o,a,i,s,c){return{type:p,scoreType:e,notes:t,durations:n,instruments:r,sustain:o,attack:a,panning:i,offset:s,repeats:c}}(e,t,n,r,i,s,c,o,"inf")}function x(e){for(var t=[],n=[],r=0,o="",a=0,i=0;i<e.length;i+=1){var s=e[i];" "!==s?(""===o?r=a:(t.push(o),n.push(a)),o=s,a=1):a+=1}return""!=o&&(t.push(o),n.push(a)),{chars:t,durations:n,offset:r}}function T(e){var t,n=e.charAt(0),o=e.slice(-1),a=!1;switch(n){case"<":t=m,a=">"===o;break;case"^":t=w,a="^"===o}if(!a)throw new r.ParserException("Score modifier delimiters don't match. Starts with ".concat(n," but ends with ").concat(o));return function(e,t){return{type:y,modifierType:e,values:t}}(t,e.slice(1,-1).split("").map(function(e){return parseInt(e,10)}))}var E=new r.Parser;E.parse=function(e){var t=i.tokenize(e);return this.initialize(t),this.program()},E.program=function(){for(var e=[];!this.eof();)this.la1("newline")?this.match("newline"):e.push(this.statement());return function(e){return{type:s,statements:e}}(e)},E.statement=function(){if(this.la1("tempo"))throw new r.ParserException("Don't support tempo changes yet");if(this.la1("tonic"))throw new r.ParserException("Don't support tonic changes yet");if(this.la1("scale"))throw new r.ParserException("Don't support scale changes yet");if(this.la1("grid"))throw new r.ParserException("Don't support grid changes yet");if(this.la1("group"))throw new r.ParserException("Don't support grid changes yet");var e,t=(e=this.match("identifier").content,{type:u,name:e});if(this.la1("play arrow"))return this.match("play arrow"),function(e,t){return{type:c,agent:e,score:t}}(t,this.score());if(this.la1("add effect arrow"))throw new r.ParserException("Don't support adding effects yet");if(this.la1("remove effect arrow"))throw new r.ParserException("Don't support removing effects yet")},E.score=function(){var e="";return this.la1("identifier")&&(e=this.match("identifier").content),k(e,this.match("score").content,this.scoreModifiers())},E.scoreModifiers=function(){for(var e=[];!this.eof()&&!this.la1("newline");)if(this.la1("operator")){var t=this.scoreOperator();e.push(t)}else{if(!this.la1("score modifier"))throw new r.ParserException("Unexpected token: Expecting operator or score modifier");var n=T(this.match("score modifier").content);e.push(n)}return e},E.scoreOperator=function(){return g(this.match("operator").content,this.match("number").content)},E.scoreOperator=function(){return g(this.match("operator").content,this.match("number").content)};var O=E;function P(e){switch(e.type){case c:return function(e){var t,n=e.agent,r=e.score;switch(r.scoreType){case f:t="percussive";break;case l:t="melodic";break;case h:t="concrete"}var o="inf"===r.repeats?{type:"bang"}:{type:"integer",value:r.repeats},a=[n.name,t,{type:"array",value:r.notes},{type:"array",value:r.durations},{type:"array",value:r.instruments},{type:"array",value:r.sustain},{type:"array",value:r.attack},{type:"array",value:r.panning},r.offset,o];return function(e,t){return{oscType:"message",address:e,args:t}}("/play/pattern",a)}(e)}}t.default={language:"atomiix",parser:O,transport:{toOSC:function(e){return e.statements.map(P)}}}}])});
//# sourceMappingURL=atomiix.min.js.map