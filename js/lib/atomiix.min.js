!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.atomiix=t():e.atomiix=t()}(global,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){var r,o,a;o=[t],void 0===(a="function"==typeof(r=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a={lang:{isNullOrUndefined:function(e){return null==e}},extend:function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}},i=function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return o(t,e),t}(Error),s=function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return o(t,e),t}(Error),u=function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return o(t,e),t}(Error),c=function(){function e(t){n(this,e),this.options=a.extend({},{languageName:"unnamedlanguage"},t),this.tokenTypes=[]}return t(e,[{key:"addTokenType",value:function(e){if(!e.name)throw new i("Token types must have a 'name' property");if(!e.regexp&&!e.consume)throw new i("Token types must have a 'regexp' property or a 'consume' function");if(e.regexp&&!(e.regexp instanceof RegExp))throw new i("Token types 'regexp' property must be an instance of RegExp");if(e.consume&&"function"!=typeof e.consume)throw new i("Token types 'consume' property must be a function");if(e.interpret&&"function"!=typeof e.interpret)throw new i("Token types 'interpret' property must be a function");this.tokenTypes.push(e)}},{key:"tokenize",value:function(e){if(void 0===e)throw new s("No content provided");if(0===this.tokenTypes.length)throw new s("No token types defined");for(var t,n,r=[],o=e,i=new l,u=this.tokenTypes.length;o.length>0;){for(var c=!1,p=0;p<u;p++){var f=this.tokenTypes[p];if(n=void 0,f.consume){if(!(n=f.consume(o)).success)continue;if(0!==o.indexOf(n.consumed))throw new s("The consume function for "+f.name+" failed to return the start of the remaining content at "+i.line+"."+i.character+" and instead returned "+n.consumed);c=!0,t=n.consumed}else{var h=f.regexp.exec(o);if(!h)continue;if(0!==h.index)continue;c=!0,t=h[0]}var y={content:e=f.interpret?f.interpret(t):n&&!a.lang.isNullOrUndefined(n.content)?n.content:t,type:f.name,line:i.line,character:i.character};f.ignore||r.push(y),o=o.substring(t.length),i.consume(t)}if(!c){var d=o.substring(0,15),m=d.replace("\r","\\r").replace("\t","\\t").replace("\n","\\n");throw new s("No viable alternative at "+i.line+"."+i.character+": '"+m+"...'")}}return r}}]),e}(),p=function(){function e(){n(this,e)}return t(e,null,[{key:"constant",value:function(e,t,n){return n=n||["keyword"],{name:t,regexp:new RegExp("^"+(r=e,r.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1"))),role:n};var r}},{key:"floatingPoint",value:function(){return{name:"floating point",regexp:/(^-?\d*\.\d+)/,role:["constant","numeric"],interpret:function(e){return parseFloat(e)}}}},{key:"integer",value:function(){return{name:"integer",regexp:/^-?\d+/,role:["constant","numeric"],interpret:function(e){return parseInt(e)}}}},{key:"whitespace",value:function(){return{name:"whitespace",ignore:!0,regexp:/^[ \t]+/}}},{key:"whitespaceWithNewlines",value:function(){return{name:"whitespace",ignore:!0,regexp:/^[ \t\r\n]+/}}},{key:"real",value:function(){return{name:"real number",regexp:/^X/,role:["constant","numeric"]}}},{key:"comma",value:function(){return this.constant(",","comma",["punctuation"])}},{key:"period",value:function(){return this.constant(".","period",["punctuation"])}},{key:"star",value:function(){return this.constant("*","star",["punctuation"])}},{key:"colon",value:function(){return this.constant(":","colon",["punctuation"])}},{key:"openParen",value:function(){return this.constant("(","open paren",["punctuation"])}},{key:"closeParen",value:function(){return this.constant(")","close paren",["punctuation"])}},{key:"openBracket",value:function(){return this.constant("{","open bracket",["punctuation"])}},{key:"closeBracket",value:function(){return this.constant("}","close bracket",["punctuation"])}},{key:"openSquareBracket",value:function(){return this.constant("[","open square bracket",["punctuation"])}},{key:"closeSquareBracket",value:function(){return this.constant("]","close square bracket",["punctuation"])}},{key:"JsonString",value:function(){return{name:"string",regexp:/"(?:[^"\\]|\\.)*"/,consume:function(e){var t={success:!1};if(0!==e.indexOf('"'))return t;var n,r="",o=1,a=!1;do{switch(n=e[o],o+=1,n){case'"':a=!0;break;case"\\":var i=e[o];switch(o+=1,i){case'"':return t;case"t":r+="\t";break;case"r":r+="\r";break;case"n":r+="\n";break;case"u":var s=e.substr(o,4);if(4==s.length&&/\d{4}/.test(s)){o+=4;var u=parseInt(s,10),c=String.fromCharCode(u);r+=c}else r+="\\u";break;default:return t}break;default:r+=n}}while(!a);var p=e.substring(0,o),f={success:!0,consumed:p,content:r};return f}}}}]),e}(),f=function(){function e(){n(this,e)}return t(e,[{key:"initialize",value:function(e){if(!e)throw new u("No tokens provided to the parser");if(!(e instanceof Array))throw new u("A non-array was provided to the parser instead of a token array");this.tokens=e}},{key:"la1",value:function(e){if(this.eof())throw new u("No tokens available");return this.tokens[0].type==e}},{key:"match",value:function(e){if(this.eof())throw new u("Expected "+e+" but found EOF");if(!this.la1(e))throw new u("Expected "+e+" but found "+this.tokens[0].type+" at l"+this.tokens[0].line+"."+this.tokens[0].character);return this.tokens.shift()}},{key:"eof",value:function(){return 0===this.tokens.length}},{key:"expectEof",value:function(){if(!this.eof())throw new u("Expected EOF but found "+this.tokens[0].type+" at l"+this.tokens[0].line+"."+this.tokens[0].character)}}]),e}(),l=function(){function e(){n(this,e),this.line=1,this.character=1,this.justSeenSlashR=!1}return t(e,[{key:"consume",value:function(e){for(var t=0,n=e.length;t<n;t++)"\r"==e[t]?(this.line+=1,this.character=1,this.justSeenSlashR=!0):"\n"==e[t]?(this.justSeenSlashR||(this.line+=1),this.character=1,this.justSeenSlashR=!1):(this.character+=1,this.justSeenSlashR=!1)}}]),e}();e.PatternDefinitionException=i,e.LexerException=s,e.ParserException=u,e.Lexer=c,e.StandardTokenTypes=p,e.Parser=f,e.LineTracker=l})?r.apply(t,o):r)||(e.exports=a)},function(e,t,n){"use strict";n.r(t);var r=n(0),o=r.StandardTokenTypes,a=new r.Lexer({languageName:"atomiix"});a.addTokenType(o.whitespace()),a.addTokenType({name:"newline",regexp:/^\n[ \n]*/}),a.addTokenType({name:"comment",ignore:!0,regexp:/^\/\/[^\n]*/}),a.addTokenType(o.constant("->","play arrow")),a.addTokenType(o.constant(">>","add effect arrow")),a.addTokenType(o.constant("<<","remove effect arrow")),a.addTokenType(o.openParen()),a.addTokenType(o.closeParen()),a.addTokenType({name:"operator",regexp:/^[*\/+-]+/}),a.addTokenType({name:"number",regexp:/^\d+(\.\d+)?/,role:["constant","numeric"],interpret:function(e){return parseFloat(e)}}),a.addTokenType({name:"identifier",regexp:/^[a-zA-Z][a-zA-Z0-9]*/}),a.addTokenType({name:"score",regexp:/^[{[\\|][a-zA-Z0-9 ]*[}\]\\|]/}),a.addTokenType({name:"score modifier",regexp:/^[<\\^][Z0-9 ]*[>\\^]/});var i=a,s="PROGRAM",u="PLAY",c="AGENT",p="SCORE",f="PERCUSSIVE",l="MELODIC",h="CONCRETE",y="SCOREOPERATOR",d="SCOREMODIFIER",m="PANNING",v="SUSTAIN",g="ATTACK";function w(e,t,n,r,o,a){return{type:p,scoreType:e,instrument:t,values:n,durations:r,offset:o,modifiers:a}}function k(e,t,n,r,o,a,i){return{type:p,scoreType:h,pitch:e,amplitudes:t,durations:n,instrument:r,panning:o,offset:a,repeats:i}}function b(e,t){return{type:y,operator:e,value:t}}function x(e){for(var t=[],n=[],r=0,o="",a=0,i=0;i<e.length;i+=1){var s=e[i];" "!==s?(""===o?r=a:(t.push(o),n.push(a)),o=s,a=1):a+=1}return""!=o&&(t.push(o),n.push(a)),{chars:t,durations:n,offset:r}}function T(e){var t,n=e.charAt(0),o=e.slice(-1),a=!1;switch(n){case"<":t=m,a=">"===o;break;case"^":t=g,a="^"===o}if(!a)throw new r.ParserException("Score modifier delimiters don't match. Starts with ".concat(n," but ends with ").concat(o));return function(e,t){return{type:d,modifierType:e,values:t}}(t,e.slice(1,-1).split("").map(function(e){return parseInt(e,10)}))}var P=new r.Parser;P.parse=function(e){var t=i.tokenize(e);return this.initialize(t),this.program()},P.program=function(){for(var e=[];!this.eof();)this.la1("newline")?this.match("newline"):e.push(this.statement());return function(e){return{type:s,statements:e}}(e)},P.statement=function(){if(this.la1("tempo"))throw new r.ParserException("Don't support tempo changes yet");if(this.la1("tonic"))throw new r.ParserException("Don't support tonic changes yet");if(this.la1("scale"))throw new r.ParserException("Don't support scale changes yet");if(this.la1("grid"))throw new r.ParserException("Don't support grid changes yet");if(this.la1("group"))throw new r.ParserException("Don't support grid changes yet");var e,t=(e=this.match("identifier").content,{type:c,name:e});if(this.la1("play arrow"))return this.match("play arrow"),function(e,t){return{type:u,agent:e,score:t}}(t,this.score());if(this.la1("add effect arrow"))throw new r.ParserException("Don't support adding effects yet");if(this.la1("remove effect arrow"))throw new r.ParserException("Don't support removing effects yet")},P.score=function(){var e="";return this.la1("identifier")&&(e=this.match("identifier").content),function(e,t,n){var o=t.charAt(0),a=t.slice(-1),i=!1;switch(o){case"|":i="|"===a;break;case"[":i="]"===a;break;case"{":i="}"===a}if(!i)throw new r.ParserException("Score delimiters don't match. Starts with ".concat(o," but ends with ").concat(a));var s,u=t.slice(1,-1);switch(o){case"|":if(e)throw new r.ParserException("Percussive score shouldn't have instrument: ".concat(e));return s=x(u),w(f,null,s.chars,s.durations,s.offset,n);case"[":if(!e)throw new r.ParserException("Melodic score should have an instrument");return s=x(u),w(l,e,s.chars.map(function(e){return parseInt(e,10)}),s.durations,s.offset,n);case"{":if(!e)throw new r.ParserException("Concrete score should have an instrument");return s=x(u),w(h,e,s.chars.map(function(e){return parseInt(e,10)}),s.durations,s.offset,n);default:throw new r.ParserException("".concat(o," is not a supported score delimiters"))}}(e,this.match("score").content,this.scoreModifiers())},P.scoreModifiers=function(){for(var e=[];!this.eof()&&!this.la1("newline");)if(this.la1("operator")){var t=this.scoreOperator();e.push(t)}else{if(!this.la1("score modifier"))throw new r.ParserException("Unexpected token: Expecting operator or score modifier");var n=T(this.match("score modifier").content);e.push(n)}return e},P.scoreOperator=function(){return b(this.match("operator").content,this.match("number").content)},P.scoreOperator=function(){return b(this.match("operator").content,this.match("number").content)};var E=P,O={names:{Maj:"Maj"},notes:{Maj:[0,2,4,5,7,9,11,12,14]}};function S(e,t,n){var r;switch(n.scoreType){case f:r=function(e,t){var n="inf"===t.repeats?{type:"bang"}:{type:"integer",value:t.repeats};return[{type:"string",value:"percussive"},{type:"string",value:e.name},{type:"array",value:t.notes},{type:"array",value:t.durations},{type:"array",value:t.instruments},{type:"array",value:t.sustain},{type:"array",value:t.attack},{type:"array",value:t.panning},{type:"integer",value:t.offset},n]}(t,n);break;case l:r=function(e,t){var n="inf"===t.repeats?{type:"bang"}:{type:"integer",value:t.repeats};return[{type:"string",value:"melodic"},{type:"string",value:e.name},{type:"array",value:t.notes},{type:"array",value:t.durations},{type:"string",value:t.instrument},{type:"array",value:t.sustain},{type:"array",value:t.attack},{type:"array",value:t.panning},{type:"integer",value:t.offset},n]}(t,n);break;case h:r=function(e,t){var n="inf"===t.repeats?{type:"bang"}:{type:"integer",value:t.repeats};return[{type:"string",value:"concrete"},{type:"string",value:e.name},{type:"integer",value:t.pitch},{type:"array",value:t.amplitudes},{type:"array",value:t.durations},{type:"string",value:t.instrument},{type:"array",value:t.panning},{type:"integer",value:t.offset},n]}(t,n)}return function(e,t){return{oscType:"message",address:e,args:t}}(e,r)}function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){var t="function"==typeof Map?new Map:void 0;return(R=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return A(e,arguments,N(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),M(r,e)})(e)}function A(e,t,n){return(A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&M(o,n.prototype),o}).apply(null,arguments)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=_(this,N(t).call(this,e))).name="AtomiixRuntimeError",n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,R(Error)),t}();function D(e,t){switch(t.type){case u:return function(e,t){var n=t.agent,r=t.score,o=r.scoreType;switch(o){case f:return function(e,t,n){var r=I(e,[60],n.modifiers),o=r.notes,a=r.sustain,i=r.attack,s=r.panning,u=r.repeats,c=n.durations,l=n.values,h=n.offset,y=function(e,t,n,r,o,a,i,s){return{type:p,scoreType:f,notes:e,durations:t,instruments:n,sustain:r,attack:o,panning:a,offset:i,repeats:s}}(o,c,l,a,i,s,h,u);return[S(e.oscAddresses.playPattern,t,y)]}(e,n,r);case l:return function(e,t,n){var r=n.values.map(function(t){return function(e,t){return e.tonic+O.notes[e.scale][t]}(e,t)}),o=I(e,r,n.modifiers),a=o.notes,i=o.sustain,s=o.attack,u=o.panning,c=o.repeats,f=n.durations,h=n.instrument,y=n.offset,d=function(e,t,n,r,o,a,i,s){return{type:p,scoreType:l,notes:e,durations:t,instrument:n,sustain:r,attack:o,panning:a,offset:i,repeats:s}}(a,f,h,i,s,u,y,c);return[S(e.oscAddresses.playPattern,t,d)]}(e,n,r);case h:return function(e,t,n){var r=I(e,[],n.modifiers),o=r.panning,a=r.repeats,i=n.values,s=n.durations,u=n.instrument,c=n.offset,p=k(60,i,s,u,o,c,a);return[S(e.oscAddresses.playPattern,t,p)]}(e,n,r);default:throw new C("".concat(o," is not a supported score type"))}}(e,t);default:throw new C("".concat(t.type," is not a supported statement type"))}}function I(e,t,n){for(var r=t,o=[],a=[],i=[],s=function(e){var t=n[e];if(t.type===d)switch(t.modifierType){case m:i=t.values;break;case v:o=t.values;break;case g:a=t.values}else if(t.type===y)switch(t.operator){case"+":r=r.map(function(e){return e+t.value});break;case"-":r=r.map(function(e){return e-t.value})}},u=0;u<n.length;u+=1)s(u);return{notes:r,sustain:o,attack:a,panning:i,repeats:"inf"}}t.default={language:"atomiix",parser:E,interpreter:{createState:function(){return{scale:O.names.Maj,tonic:60,oscAddresses:{playPattern:"/play/pattern"}}},interpret:function(e,t){for(var n=[],r=0;r<t.statements.length;r+=1){var o=D(e,t.statements[r]);o&&(n=n.concat(o))}return{newState:e,messages:n}}}}}])});
//# sourceMappingURL=atomiix.min.js.map